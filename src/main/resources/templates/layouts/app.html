<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
  <head>
    <title layout:title-pattern="$CONTENT_TITLE | $LAYOUT_TITLE">
      AizaTransport?
    </title>
    <!-- Common CSS links, e.g., Bootstrap CDN link -->
    <link rel="stylesheet" th:href="@{/bs5.3/css/bootstrap.min.css}" />

    <!-- FA-Icons -->
    <link rel="stylesheet" th:href="@{/fa/css/all.min.css}" />

    <script th:src="@{/bs5.3/js/bootstrap.bundle.min.js}" defer></script>
    <script th:src="@{/fa/js/all.min.js}" defer></script>
    <script th:src="@{/chartjs/chart.umd.min.js}"></script>

    <!-- Page-specific scripts can be included here -->
    <th:block layout:fragment="script"></th:block>

    <style>
      * {
        border-radius: 0 !important;
      }

      body {
        display: flex;
        min-height: 100vh;
        flex-direction: column;
      }

      .navbar {
        position: fixed;
        z-index: 200;
        width: 100vw;
        background-color: #000;
        border-bottom: 2px solid #333;
      }

      .navbar-brand {
        color: #fff !important;
        font-weight: 600;
        letter-spacing: 1px;
      }

      .sidebar {
        position: fixed;
        top: 56px;
        left: 0;
        bottom: 0;
        width: 250px;
        height: calc(100vh - 56px);
        background-color: #1a1a1a;
        border-right: 2px solid #333;
        overflow-y: auto;
        z-index: 100;
      }

      .sidebar-nav {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .sidebar-nav .nav-item {
        border-bottom: 1px solid #333;
      }

      .sidebar-nav .nav-link {
        color: #ccc !important;
        padding: 1rem 1.5rem;
        min-height: 54px;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        transition: all 0.3s;
        border-left: 3px solid transparent;
        text-decoration: none;
      }

      .sidebar-nav .nav-link:hover {
        background-color: #2a2a2a;
        color: #fff !important;
        border-left-color: #fff;
      }

      .sidebar-nav .nav-link.active {
        background-color: #333;
        color: #fff !important;
        border-left-color: #fff;
      }

      .sidebar-nav .nav-link i {
        width: 20px;
        text-align: center;
      }

      /* Accordion Styles */
      .sidebar .accordion {
        --bs-accordion-bg: transparent;
        --bs-accordion-border-color: #333;
        --bs-accordion-btn-bg: transparent;
        --bs-accordion-btn-color: #888;
        --bs-accordion-active-bg: transparent;
        --bs-accordion-active-color: #fff;
      }

      .sidebar .accordion-button {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        padding: 1rem 1.5rem;
        min-height: 54px;
        border: none;
        box-shadow: none !important;
      }

      .sidebar .accordion-button:not(.collapsed) {
        background-color: transparent;
        color: #fff;
      }

      .sidebar .accordion-button::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23888'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
        filter: brightness(0.8);
      }

      .sidebar .accordion-button:not(.collapsed)::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23fff'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
      }

      .sidebar .accordion-body {
        padding: 0;
      }

      .sidebar .accordion-item {
        background-color: transparent;
        border: none;
        border-bottom: 1px solid #333;
      }

      .sidebar .accordion-item:last-child {
        border-bottom: 1px solid #333;
      }

      /* Split accordion header (link + toggle) */
      .sidebar .accordion-header-split {
        display: flex;
        align-items: stretch;
        border-bottom: 1px solid #333;
        min-height: 54px;
      }

      .sidebar .accordion-link {
        flex: 1;
        color: #fff;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        padding: 1rem 0.5rem 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        transition: all 0.3s;
        background-color: transparent;
      }

      .sidebar .accordion-link:hover {
        color: #fff;
        background-color: #2a2a2a;
      }

      .sidebar .accordion-toggle {
        width: 40px;
        min-height: 54px;
        background-color: transparent;
        border: none;
        color: #888;
        cursor: pointer;
        position: relative;
        transition: all 0.3s;
        flex-shrink: 0;
      }

      .sidebar .accordion-toggle:hover {
        background-color: #2a2a2a;
        color: #fff;
      }

      .sidebar .accordion-toggle::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 16px;
        height: 16px;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23888'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
        background-size: contain;
        background-repeat: no-repeat;
        transition: transform 0.3s;
      }

      .sidebar .accordion-toggle:not(.collapsed)::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23fff'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
        transform: translate(-50%, -50%) rotate(180deg);
      }

      .sidebar .accordion-toggle:hover::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23fff'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
      }

      /* Nested split headers indentation */
      .sidebar .accordion-body .accordion-header-split > .accordion-link {
        padding-left: 2.5rem;
        font-size: 0.7rem;
      }

      .sidebar .accordion-body .accordion-body .accordion-header-split .accordion-link {
        padding-left: 3.5rem;
        font-size: 0.65rem;
      }

      .sidebar .accordion-body .accordion-body .accordion-body .accordion-header-split .accordion-link {
        padding-left: 4.5rem;
        font-size: 0.6rem;
      }

      /* Nested accordion indentation */
      .sidebar .accordion-body .accordion {
        margin-left: 0;
      }

      .sidebar .accordion-body .accordion-button {
        padding-left: 2.5rem;
        font-size: 0.7rem;
      }

      .sidebar .accordion-body .accordion-body .accordion-button {
        padding-left: 3.5rem;
        font-size: 0.65rem;
      }

      .sidebar
        .accordion-body
        .accordion-body
        .accordion-body
        .accordion-button {
        padding-left: 4.5rem;
        font-size: 0.6rem;
      }

      .sidebar .accordion-body .sidebar-nav .nav-link {
        padding-left: 2.5rem;
      }

      .sidebar .accordion-body .accordion-body .sidebar-nav .nav-link {
        padding-left: 3.5rem;
      }

      .sidebar
        .accordion-body
        .accordion-body
        .accordion-body
        .sidebar-nav
        .nav-link {
        padding-left: 4.5rem;
      }

      .main-wrapper {
        margin-left: 250px;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      main {
        flex: 1;
        margin-top: 3em;
        background-color: #f5f5f5;
      }

      footer {
        background-color: #000;
        color: #ccc;
        border-top: 2px solid #333;
        padding: 2rem 0;
      }

      footer a {
        color: #999;
        text-decoration: none;
        transition: color 0.3s;
      }

      footer a:hover {
        color: #fff;
      }

      .btn {
        border-radius: 0;
        transition: all 0.3s;
      }

      .btn-primary {
        background-color: #000;
        border: 1px solid #000;
        color: #fff;
      }

      .btn-primary:hover {
        background-color: #333;
        border: 1px solid #333;
      }

      .btn-outline-light {
        border: 1px solid #fff;
        color: #fff;
      }

      .btn-outline-light:hover {
        background-color: #fff;
        color: #000;
      }

      @media (max-width: 768px) {
        .sidebar {
          left: -250px;
          transition: left 0.3s;
        }

        .sidebar.show {
          left: 0;
        }

        .main-wrapper {
          margin-left: 0;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid px-4">
        <a class="navbar-brand" th:href="@{/}">AIZA TRANSPORT</a>
        <div class="ms-auto">
          <a class="btn btn-outline-light btn-sm" th:href="@{/logout}">
            <i class="fa-solid fa-right-from-bracket me-1"></i>
            Déconnexion
          </a>
        </div>
      </div>
    </nav>

    <!-- Sidebar -->
    <aside class="sidebar">
      <!-- Dynamic Sidebar Items -->
      <th:block th:each="item, iterStat : ${sidebarItems}">
        <th:block
          th:replace="~{::renderSidebarItem(${item}, ${iterStat.index}, '')}"
        ></th:block>
      </th:block>
    </aside>

    <!-- Recursive Fragment for Sidebar Items -->
    <th:block th:fragment="renderSidebarItem(item, index, parentId)">
      <!-- Skip null items -->
      <th:block th:if="${item != null}">
        <!-- Determine if item has children -->
        <th:block
          th:with="hasChildren=${item.items != null and !item.items.isEmpty()}"
        >
          <!-- Single Menu Item (no children) -->
          <ul th:if="${!hasChildren}" class="sidebar-nav">
            <li class="nav-item">
              <a class="nav-link" th:href="@{${item.link}}">
                <i th:class="${item.icon}"></i>
                <span th:text="${item.name}"></span>
              </a>
            </li>
          </ul>

          <!-- Accordion Section (has children) -->
          <div
            th:if="${hasChildren}"
            class="accordion accordion-flush"
            th:id="${parentId + 'accordion' + index}"
          >
            <div class="accordion-item">
              <h2 class="accordion-header">
                <!-- Item with link and children: split button -->
                <div th:if="${item.link != null and item.link != ''}" class="accordion-header-split">
                  <a class="accordion-link" th:href="@{${item.link}}">
                    <i th:if="${item.icon != null}" th:class="${item.icon}"></i>
                    <span th:text="${item.name}"></span>
                  </a>
                  <button
                    class="accordion-toggle"
                    type="button"
                    data-bs-toggle="collapse"
                    th:data-bs-target="'#' + ${parentId + 'collapse' + index}"
                    aria-expanded="true"
                    th:aria-controls="${parentId + 'collapse' + index}"
                  >
                  </button>
                </div>
                
                <!-- Item without link: regular accordion button -->
                <button
                  th:if="${item.link == null or item.link == ''}"
                  class="accordion-button"
                  type="button"
                  data-bs-toggle="collapse"
                  th:data-bs-target="'#' + ${parentId + 'collapse' + index}"
                  aria-expanded="true"
                  th:aria-controls="${parentId + 'collapse' + index}"
                  th:text="${item.name}"
                ></button>
              </h2>
              <div
                th:id="${parentId + 'collapse' + index}"
                class="accordion-collapse collapse show"
                th:data-bs-parent="'#' + ${parentId + 'accordion' + index}"
              >
                <div class="accordion-body">
                  <!-- Recursively render sub-items -->
                  <th:block th:each="subItem, subIterStat : ${item.items}">
                    <th:block
                      th:replace="~{::renderSidebarItem(${subItem}, ${subIterStat.index}, ${parentId + 'sub' + index + '_'})}"
                    ></th:block>
                  </th:block>
                </div>
              </div>
            </div>
          </div>
        </th:block>
      </th:block>
    </th:block>

    <!-- Main Content Wrapper -->
    <div class="main-wrapper">
      <!-- Main Content -->
      <main>
        <div layout:fragment="content"></div>
      </main>

      <!-- Footer -->
      <footer>
        <div class="container">
          <div class="row">
            <div class="col-md-4">
              <h6 class="text-white mb-3">AIZA TRANSPORT</h6>
              <p class="small">
                Système professionnel de gestion de taxi-brousse pour des
                services de transport efficaces.
              </p>
            </div>
            <div class="col-md-4">
              <h6 class="text-white mb-3">Liens rapides</h6>
              <ul class="list-unstyled small">
                <li class="mb-2"><a th:href="@{/}">Tableau de bord</a></li>
                <li class="mb-2"><a th:href="@{/vehicles}">Véhicules</a></li>
                <li class="mb-2"><a th:href="@{/drivers}">Chauffeurs</a></li>
                <li class="mb-2"><a th:href="@{/trips}">Voyages</a></li>
              </ul>
            </div>
            <div class="col-md-4">
              <h6 class="text-white mb-3">Contact</h6>
              <p class="small mb-2">
                <i class="fa-solid fa-envelope me-2"></i>
                contact@aizatransport.mg
              </p>
              <p class="small mb-2">
                <i class="fa-solid fa-phone me-2"></i>
                +261 XX XX XXX XX
              </p>
              <p class="small">
                <i class="fa-solid fa-location-dot me-2"></i>
                Madagascar
              </p>
            </div>
          </div>
          <hr class="my-4" style="border-color: #333" />
          <div class="row">
            <div class="col-12 text-center small">
              <p class="mb-0">
                &copy; 2026 AIZA TRANSPORT. Tous droits réservés.
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <th:block layout:fragment="script-bottom"></th:block>
  </body>
</html>
